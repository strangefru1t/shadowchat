fetch('limits').then(function(response){return response.json()}).then(function(json){var name=document.getElementById("name");var amount=document.getElementById("amount");var amountlabel=document.getElementById("amountlabel");var message=document.getElementById("message");name.value="";amount.value="";message.value="";amount.min=json.MinimumDonationXMR;amount.placeholder=json.MinimumDonationXMR+" Minimum ($"+(json.XMRUSD*amount.min).toFixed(2)+")";message.placeholder=json.MaximumMessageChars+" Characters";message.maxLength=json.MaximumMessageChars;document.getElementById('three').addEventListener('click',function(e){amount.value=(3/json.XMRUSD).toFixed(4)});document.getElementById('five').addEventListener('click',function(e){amount.value=(5/json.XMRUSD).toFixed(4)});document.getElementById('ten').addEventListener('click',function(e){amount.value=(10/json.XMRUSD).toFixed(4)})}).catch(function(err){console.log('error: '+err)});function send(){document.getElementById("pay").remove();document.getElementById("three").remove();document.getElementById("five").remove();document.getElementById("ten").remove();var data=new FormData();var formJson=JSON.stringify({"name":document.getElementById("name").value,"message":document.getElementById("message").value,"amount":parseFloat(document.getElementById("amount").value)});document.getElementById("waiting").style.display="block";fetch("pay",{method:"POST",body:formJson}).then((result)=>{if(result.status!=200){throw new Error("Bad Server Response")}return result.text()}).then((response)=>{var resp=JSON.parse(response);var nameresp=document.getElementById("name");var messageresp=document.getElementById("message");if(location.protocol == "https:"){url='wss://'+window.location.hostname+'/check?id='+resp.id}else{url='ws://'+window.location.hostname+'/check?id='+resp.id}nameresp.value=resp.name;nameresp.readOnly=true;if(resp.message==""){messageresp.remove();document.getElementById("messagelabel").remove()}else{messageresp.value=resp.message;messageresp.readOnly=true}document.getElementById("amount").readOnly=true;document.getElementById("amount").value=resp.amount;var addrlabel=document.createElement('label');addrlabel.innerText="Address";addrlabel.setAttribute("id","addresslabel");var smallwait=document.createElement('small');smallwait.innerText="Waiting for payment";var addr=document.createElement('blockquote');addr.innerText=resp.address;addr.setAttribute("id","address");var a=document.createElement('a');var linkText=document.createTextNode("Open in GUI");a.appendChild(linkText);a.setAttribute("id","opengui");a.href="monero://"+resp.address+"?tx_amount="+resp.amount;document.getElementById('form').appendChild(addrlabel);document.getElementById('form').appendChild(addr);document.getElementById('form').appendChild(a);c=new WebSocket(url);c.onmessage=function(msg){if(msg.data!="KEEPALIVE"){var wsdata=JSON.parse(msg.data);console.log(wsdata.message);document.getElementById("waiting").remove();document.getElementById("opengui").remove();document.getElementById("address").remove();document.getElementById("addresslabel").remove();document.getElementById("qr").remove();var receipt=document.createElement('blockquote');receipt.innerText=wsdata.message+" XMR received! Superchat sent.";document.getElementById('form').appendChild(receipt)}};var qr=document.createElement('img');qr.src='data:image/png;base64,'+resp.qr;qr.setAttribute("id","qr");document.getElementById('form').appendChild(qr);console.log(JSON.parse(response))}).catch((error)=>{console.log(error)});return false}